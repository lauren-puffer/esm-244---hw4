---
title: "ESM 244 - HW4"
author: "Lauren Puffer"
format: html
editor: visual
embed-resources: true
code-fold: show
execute: 
  warning: false
  message: false
toc: TRUE
theme: journal
---

# Overview

### Purpose of Analysis

With this analysis, we aim to assess possible temporal trends of Coho salmon, Jack Coho salmon, and Steelhead trout in the Columbia River Basin. Our analysis will use a simple data manipulation in the 'lubridate' package for compatibility with visualization tools. We will then explore patterns in seasonality and overall trends, as well as compare fish counts by month using 'ggsubseries.'

### *insert photo here*

### Data citation

Data were shared by and accessed from [Columbia River DART](http://www.cbr.washington.edu/dart/query/adult_graph_text) (Data Access in Real Time), accessed January 25, 2023. This data comes from a collaboration of 8 entities monitoring fish populations in the Columbia Basin. Fish counts for 9 species and water temperature is recorded daily.

### Pseudocode

1.  Load necessary packages, including fable and feast
2.  Read in the data and pivot longer to create distinct column for type and count
3.  Put data into a tsibble table for ease of use
4.  Conduct exploratory data analysis to look for obvious trends
5.  Plot daily counts to look for temporal trends in data
6.  Convert data into week-year format and plot for seasonality

## Load packages

```{r}
library(tidyverse)
library(janitor)
library(here)
library(dplyr) #change NAs to zeros
library(tsibble) #make a dataframe
library(lubridate) #used for altering time series data
library(feasts) 
library(fable)
library(patchwork)
```

## Data wrangling

```{r load data and prepare for time series analysis}
# load data from local file
fish_data <- read.csv(here("data", "willamette_fish_passage.csv")) |>
  clean_names() |>
  mutate_all(~replace(., is.na(.), 0))|>  #change NA values to zeros 
  select(date, steelhead, coho, jack_coho)|>
  mutate(date = mdy(date))


#create a distinct dataframe with species in 1 column and fish count in another column  
fish_data_long <- fish_data|> 
  pivot_longer(cols = c(jack_coho, coho, steelhead), 
               names_to= "type", 
               values_to = "count")

# create a tsibbble table ofr usability 
fish_ts <- fish_data_long |>
  as_tsibble(key = type, #not more than one variable dertmining time indeces
             index = date) #use date to specify time

```

## Overall Temporal Trends

```{r plot data}
#| fig-cap: "Fig. 1 - Daily fish counts for adult Steelhead trout, jack Coho salmon, and Coho salmon observed in the Columbia River Basin."

ggplot(data = fish_ts, 
       aes(x = date, y = count, colour = type)) +
  geom_line() +
  labs(x = "Date", 
       y = "Daily Counts",
       title = "Daily Counts by Type") +
  scale_color_manual(values = c("steelhead" = "goldenrod1", 
                                "jack_coho" = "deeppink3", 
                                "coho" = "chartreuse3")) +  # Custom colors
  theme_classic()

```

Based on the information shown in figure 1, it seems that the amount of Coho salmon in the basin spiked in the late 2000s and early 2010s. The seasonality for Steelhead and Coho salmon seem to alternate. When counts for Steelhead are low or near zero, Coho counts increase.

geom_stream

## Seasonality

We will make seasonality plots to see how abundances (counts) each fish type tend to behave on a year-long scale.

```{r}
# weekly coho jack 
jack_week <- fish_ts |> 
  filter(type == "jack_coho") |>
  index_by(week = ~yearweek(.)) |> #use yearweek to convert date
  summarize(weekly_count = mean(count, na.rm = TRUE)) |>
      ungroup() 

#plots seasonal average across year
jack_season <- jack_week|>
  gg_season(y = weekly_count) +
  geom_line() +
  labs(x = "Month", y = "Weekly Average Count", title= "Jack Coho salmon") +
  theme_minimal() +
  theme(legend.position = "none") 


#do the same for coho
coho_week <- fish_ts |> 
  filter(type == "coho") |>
  index_by(week = ~yearweek(.)) |> #use yearweek to convert date
  summarize(weekly_count = mean(count, na.rm = TRUE)) |>
      ungroup() 

#plots seasonal average across year
coho_season <- coho_week|>
  gg_season(y = weekly_count) +
  geom_line() +
  labs(x = "Month", y = "Weekly Average Count", title = "Coho salmon") +
  theme_minimal()

#do the same for steelhead
steelhead_week <- fish_ts |> 
  filter(type == "steelhead") |>
  index_by(week = ~yearweek(.)) |> #use yearweek to convert date
  summarize(weekly_count = mean(count, na.rm = TRUE)) |>
      ungroup() 

#plots seasonal average across year
steelhead_season <- steelhead_week|>
  gg_season(y = weekly_count) +
  geom_line() +
  labs(x = "Month", y = "Weekly Average Count", title = "Steelhead trout") +
  theme_minimal() +
    theme(legend.position = "none") 

patch <- jack_season/coho_season/steelhead_season

print(patch)
```

## Annual Counts

create graph that shows the count of fish by type per each year of observation.

```{r}


```
